{% extends 'layouts/app_layout.html' %}

{% block page_title %}Inventory{% endblock %}

{% block page_description %}View and manage your generated products.{% endblock %}

{% block content %}
<!-- CSRF Token for AJAX requests -->
{% csrf_token %}

<!-- Project Filter Section -->
{% if projects %}
<div class="card mb-3">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="projectFilter" class="form-label">Filter by Project</label>
                <select class="form-select" id="projectFilter" name="project" onchange="this.form.submit()">
                    <option value="">All Projects</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}" {% if project_filter == project.id|stringformat:"s" %}selected{% endif %}>
                            {{ project.name }} ({{ project.product_count }} products)
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                {% if project_filter %}
                    <a href="{% url 'main:inventory' %}" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-x-circle"></i> Clear Filter
                    </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endif %}

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
            Product Gallery
            {% if current_project %}
                <small class="text-muted">- {{ current_project.name }}</small>
            {% endif %}
        </h2>
    </div>
    <div class="card-body">
        <!-- Unified Product Collection Container -->
        <div id="inventoryCollection"></div>
        
        <!-- Pagination -->
        {% include 'components/navigation/pagination.html' with page_obj=page_obj aria_label="Product pagination" query_params=request.GET %}
    </div>
</div>

<!-- Product Data and Collection Initialization -->
{% include 'components/js/product_data_init.html' with data_variable='inventoryProductsData' products_json=products_json comment='Initialize inventory collection with data' %}
{% include 'components/js/product_collection_init.html' with collection_id='inventoryCollection' data_variable='inventoryProductsData' click_action='select' %}
{% endblock %}